# Celebrity Trade Bot - 产品需求文档 (PRD)

## 文档信息
- 版本：1.0
- 最后更新：2024-09-16
- 状态：草稿

## 1. 产品介绍

### 1.1 产品概述
Celebrity Trade Bot 是一个自动化交易决策系统，通过监控有市场影响力的名人在社交媒体上的活动，结合市场数据分析，使用 AI 给出交易建议，并将这些建议通过 Telegram 推送给用户，未来版本将支持自动执行交易操作。

### 1.2 产品目标
- 创建一个能够监控名人社交媒体活动的自动化系统
- 结合市场数据分析，实时生成潜在的交易机会
- 通过 AI 分析提供高质量的交易建议
- 将这些建议及时传达给用户
- 为未来的自动交易执行功能奠定基础

### 1.3 目标用户
- 对加密货币和股票市场感兴趣的个人投资者
- 希望基于社交媒体影响进行交易决策的用户
- 寻求自动化或半自动化交易解决方案的用户
- 对名人言论与市场之间关系感兴趣的交易者

## 2. 功能需求

### 2.1 配置管理
#### 2.1.1 监控配置
- **监控账号列表**：用户可配置需要监控的社交媒体账号
  - 每个账号配置包含：平台类型(Twitter/X, Truth Social等)、账号ID/用户名、账号显示名称、描述
  - 初始默认账号：Donald Trump (@realDonaldTrump), Elon Musk (@elonmusk)
  - 支持动态添加和删除监控账号

- **市场监控列表**：用户可配置需要监控的金融产品
  - 每个市场产品配置包含：类型(股票/加密货币)、代码(Ticker)、全名、描述
  - 初始默认市场：SPY, QQQ, BTC, ETH, SOL
  - 支持动态添加和删除监控市场

#### 2.1.2 系统配置
- **API密钥管理**：
  - Twitter/X API 密钥
  - 金融数据 API 密钥
  - Gemini API 密钥
  - Telegram Bot Token 和 Chat ID
  - 未来：加密货币交易所 API 密钥

- **监控参数配置**：
  - 社交媒体查询频率（默认：5分钟）
  - 市场数据查询频率（默认：15分钟）
  - 数据保留时长（默认：30天）
  - AI 分析时使用的历史数据量（默认：过去30天）

- **通知设置**：
  - Telegram 通知开关
  - 通知类型过滤（可选择只接收"买入"或"卖出"建议，忽略"中立"）
  - 置信度阈值（例如：只发送置信度>70%的建议）

### 2.2 社交媒体监控
#### 2.2.1 数据采集
- 定期查询配置的社交媒体账号的新活动
- 支持采集的活动类型：
  - 原创发布（推文）
  - 回复他人
  - 转发/引用推文
- 对于每条社交媒体活动，记录：
  - 内容ID
  - 账号信息
  - 发布时间
  - 文本内容
  - 媒体内容链接（如图片、视频）
  - 互动数据（点赞数、评论数、转发数）
  - 相关链接（如果包含）

#### 2.2.2 变化检测
- 检测新的社交媒体活动
- 避免重复处理已分析过的内容
- 为每个新检测到的活动触发分析流程

### 2.3 市场数据监控
#### 2.3.1 数据采集
- 定期查询配置的金融产品的市场数据
- 对于每个市场产品，记录：
  - 当前价格
  - 价格变化（绝对值和百分比）
  - 交易量
  - 24小时高低点
  - 其他相关市场指标

#### 2.3.2 历史数据管理
- 存储所有采集的市场数据
- 按配置的时间长度保留历史数据
- 支持查询特定时间范围内的市场数据

### 2.4 AI 分析
#### 2.4.1 分析触发
- 当检测到配置的社交媒体账号有新活动时触发分析
- 支持手动触发分析（未来功能）

#### 2.4.2 数据准备
- 收集当前触发事件的完整信息
- 获取该账号最近的社交媒体活动历史
- 提取最近一段时间（默认一个月）的相关市场数据
- 获取近期相关财经新闻（可选）

#### 2.4.3 AI 分析请求
- 使用 Gemini API 进行分析
- 构建结构化的 prompt，包含：
  - 任务描述：根据社交媒体和市场数据分析可能的交易机会
  - 当前事件数据：触发分析的社交媒体活动
  - 历史数据：该账号最近的活动和市场历史数据
  - 新闻数据：相关市场近期新闻（如果可用）
  - 输出格式要求：交易建议、置信度、理由
- 处理 AI 返回的结果，解析为结构化数据

#### 2.4.4 结果处理
- 解析 AI 返回的分析结果
- 提取关键部分：
  - 交易建议（买入/卖出/中立）
  - 受影响的市场/资产
  - 置信度评分（百分比）
  - 决策理由和分析
  - 相关支持信息或引用
- 将分析结果存储到系统中
- 触发通知流程

### 2.5 通知管理
#### 2.5.1 Telegram 通知
- 创建格式化的通知消息，包含：
  - 触发事件简要信息（谁、什么时间、说了什么）
  - 分析结果（建议、置信度、理由）
  - 相关市场数据简要
  - 时间戳
- 通过配置的 Telegram Bot 发送通知
- 支持富文本格式（粗体、斜体、链接等）
- 支持通知失败时的重试机制

#### 2.5.2 通知记录
- 记录所有发送的通知
- 存储通知的发送状态（成功/失败）
- 支持查询历史通知记录

### 2.6 数据存储和管理
#### 2.6.1 数据模型
- **账号配置**：
  - ID
  - 平台类型
  - 账号名称
  - 账号描述
  - 状态（启用/禁用）

- **市场配置**：
  - ID
  - 市场类型
  - 资产代码
  - 资产名称
  - 描述
  - 状态（启用/禁用）

- **社交媒体数据**：
  - ID
  - 账号 ID
  - 平台
  - 内容 ID
  - 内容类型
  - 发布时间
  - 文本内容
  - 媒体链接
  - 互动数据
  - 原始数据 JSON

- **市场数据**：
  - ID
  - 市场 ID
  - 时间戳
  - 价格
  - 价格变化
  - 交易量
  - 其他指标
  - 原始数据 JSON

- **分析结果**：
  - ID
  - 触发事件 ID
  - 分析时间
  - 建议类型
  - 置信度
  - 目标市场
  - 理由
  - 支持信息
  - 原始分析 JSON

- **通知记录**：
  - ID
  - 分析结果 ID
  - 发送时间
  - 发送状态
  - 通知内容
  - 错误信息（如果有）

#### 2.6.2 数据清理
- 按配置的时间周期自动清理过期数据
- 支持数据备份（可选功能）
- 维护系统日志和状态信息

### 2.7 未来功能：自动交易执行
- 集成加密货币交易所 API
- 配置交易规则和风险控制参数
- 根据 AI 建议自动执行交易
- 记录交易执行记录
- 支持交易结果通知

## 3. 用户流程

### 3.1 系统初始设置流程
1. 用户安装系统
2. 用户配置必要的 API 密钥：
   - Twitter/X API
   - 金融数据 API
   - Gemini API
   - Telegram Bot
3. 用户确认或修改默认的监控账号和市场列表
4. 用户确认或修改系统配置参数
5. 系统开始运行，进入监控状态

### 3.2 社交媒体触发分析流程
1. 系统检测到监控账号有新活动
2. 系统采集该活动的详细信息
3. 系统准备相关的历史数据和市场信息
4. 系统调用 Gemini API 进行分析
5. 系统处理分析结果
6. 系统生成并发送 Telegram 通知
7. 系统记录分析结果和通知状态

### 3.3 配置修改流程
1. 用户编辑配置文件
2. 用户添加/删除监控账号或市场
3. 用户修改系统参数
4. 系统检测到配置变化并重新加载
5. 系统确认新配置并继续运行

## 4. 非功能需求

### 4.1 性能需求
- 社交媒体检查延迟：< 5分钟
- 市场数据更新延迟：< 15分钟
- 检测到新活动到发送通知的总时间：< 10分钟
- 系统资源占用适度，可在普通个人电脑或小型服务器上运行

### 4.2 可靠性需求
- 系统应能够持续运行，不因单次 API 调用失败而完全停止
- 实现适当的错误处理和重试机制
- 系统应保持日志记录，便于故障排查
- 关键错误应通过 Telegram 通知用户

### 4.3 安全需求
- 所有 API 密钥和敏感信息应安全存储（例如使用环境变量或加密配置文件）
- 系统不应在日志中记录敏感信息
- 未来的交易功能应实现严格的访问控制和限额机制

### 4.4 可维护性需求
- 代码应结构清晰，便于理解和修改
- 配置应集中管理，便于调整
- 系统各组件应适当解耦，便于单独测试和更新
- 应提供适当的文档说明安装和配置过程

### 4.5 扩展性需求
- 系统架构应支持未来添加新的社交媒体平台
- 系统应能够灵活扩展支持新的市场和资产类型
- 应设计良好的接口，便于未来集成更多功能

## 5. 技术规格

### 5.1 API 集成详情
#### 5.1.1 Twitter/X API
- API 版本：v2
- 所需权限：
  - 读取公开推文
  - 查询用户信息
- 主要端点：
  - `GET /2/users/:id/tweets` - 获取用户最近推文
  - `GET /2/users/by/username/:username` - 根据用户名查找用户 ID

#### 5.1.2 金融数据 API
- 将使用用户提供的 API
- 所需功能：
  - 获取特定资产的最新价格
  - 获取历史价格数据
  - 支持股票和加密货币数据

#### 5.1.3 Gemini API
- 版本：最新可用版本
- 模型：Gemini Pro 或更高版本
- 主要功能：
  - 文本分析和理解
  - 基于上下文的决策生成
  - 提取结构化信息

#### 5.1.4 Telegram Bot API
- 基本功能：发送消息
- 高级功能（可选）：
  - 富文本格式
  - 内联按钮（用于交互）
  - 消息编辑

### 5.2 数据存储规格
- 使用 JSON 文件或轻量级数据库存储数据
- 将不同类型的数据存储在不同的文件/表中：
  - 配置数据
  - 社交媒体数据
  - 市场数据
  - 分析结果
  - 通知记录
- 使用索引优化查询性能
- 定期备份重要数据

### 5.3 配置文件规格
配置文件应采用 JSON 或 YAML 格式，包含以下部分：

```yaml
# 示例配置文件结构
api_keys:
  twitter:
    api_key: "xxx"
    api_secret: "xxx"
    bearer_token: "xxx"
  financial_data:
    api_key: "xxx"
  gemini:
    api_key: "xxx"
  telegram:
    bot_token: "xxx"
    chat_id: "xxx"

monitoring:
  accounts:
    - platform: "twitter"
      username: "elonmusk"
      display_name: "Elon Musk"
      description: "Tesla & SpaceX CEO"
    - platform: "twitter"
      username: "realDonaldTrump"
      display_name: "Donald Trump"
      description: "Former US President"
  
  markets:
    - type: "stock"
      ticker: "SPY"
      name: "S&P 500 ETF"
      description: "ETF tracking the S&P 500 index"
    - type: "stock"
      ticker: "QQQ"
      name: "NASDAQ-100 ETF"
      description: "ETF tracking the NASDAQ-100 index"
    - type: "crypto"
      ticker: "BTC"
      name: "Bitcoin"
      description: "Bitcoin cryptocurrency"
    - type: "crypto"
      ticker: "ETH"
      name: "Ethereum"
      description: "Ethereum cryptocurrency"
    - type: "crypto"
      ticker: "SOL"
      name: "Solana"
      description: "Solana cryptocurrency"

system:
  social_media_check_interval: 300  # 秒
  market_data_check_interval: 900  # 秒
  data_retention_days: 30
  history_analysis_days: 30

notification:
  enabled: true
  send_neutral_recommendations: true
  confidence_threshold: 60  # 百分比
```

### 5.4 通知格式规格
Telegram 通知应采用以下格式：

```
🚨 **交易信号提醒** 🚨

💬 *触发事件：*
👤 {名人名称} (@{账号名称}) 在 {时间} 发布：
"{推文内容摘要...}"

📊 *AI 分析结果：*
📈 建议: {买入/卖出/中立} {资产代码}
⚖️ 置信度: {XX%}

🔍 *分析理由:*
{AI 提供的分析理由...}

📉 *相关市场数据:*
- {资产代码}: 当前 ${价格} ({涨跌幅}%)
- {其他相关资产数据...}

⏰ 分析时间: {时间戳}
```

## 6. 开发和实施计划

### 6.1 开发阶段
1. **基础设施搭建**
   - 项目结构设置
   - 配置管理实现
   - 日志系统实现

2. **社交媒体监控模块**
   - Twitter/X API 集成
   - 数据采集和存储

3. **市场数据模块**
   - 金融数据 API 集成
   - 历史数据管理

4. **AI 分析模块**
   - Gemini API 集成
   - Prompt 设计和结果解析

5. **通知模块**
   - Telegram Bot 集成
   - 通知格式和发送逻辑

6. **集成测试**
   - 端到端流程测试
   - 性能和可靠性测试

### 6.2 优先级和依赖关系
- **P0 (必要功能)**：
  - 基础配置系统
  - 社交媒体数据采集
  - 市场数据采集
  - 简单 AI 分析
  - 基本 Telegram 通知

- **P1 (重要功能)**：
  - 更复杂的 AI 提示和分析
  - 更丰富的市场数据
  - 改进的通知格式
  - 错误处理和重试机制

- **P2 (增强功能)**：
  - 数据可视化
  - 扩展支持其他社交平台
  - 更复杂的过滤和触发机制

- **未来（V2）**：
  - 自动交易执行
  - 用户界面
  - 性能优化

## 7. 开放问题和待定事项

1. 是否需要实现一个简单的 Web 界面来查看历史通知和交易建议？
2. 如何评估 AI 给出的建议的准确性和有效性？可能需要实现一个回测系统。
3. 系统的数据备份策略需要进一步明确。
4. 未来的自动交易功能需要深入设计风险控制措施和限额机制。
5. 是否需要支持多用户配置，允许不同用户监控不同的名人和市场？ 